var CanvasEvents=function(f){if(!(f instanceof window.HTMLCanvasElement))throw"the argumant must be a canvas element";var a={};a.ctx=f.getContext("2d");a.svg=null;a.lineWidth=1;a.scale={x:1,y:1};a.rotate=0;a.translate={x:0,y:0};setInterval(function(){a.placeLayer()},100);a.placeLayer=function(){var b=getComputedStyle(a.ctx.canvas),c=a.svg.style;c.position="absolute";c.border=b.border;c.left=a.ctx.canvas.offsetLeft+"px";c.top=a.ctx.canvas.offsetTop+"px";a.svg.setAttribute("width",a.ctx.canvas.width);
a.svg.setAttribute("height",a.ctx.canvas.height)};a.createEventHandlerLayer=function(){var b=document.createElementNS("http://www.w3.org/2000/svg","svg");a.svg=b;document.querySelector("body").appendChild(b)}();a.eventObject=function(a){var b="click contextmenu dbclick mousedown mouseenter mouseleave mousemove mouseover mouseout mouseup".split(" ");return{on:function(c,e){if(-1==b.indexOf(c))throw'unsupport "'+c+'" event';a.addEventListener(c,e);return this},off:function(c,e){if(2===arguments.length){if(-1==
b.indexOf(c))throw'unsupport "'+c+'" event';a.removeEventListener(c,e)}else{var d=a.cloneNode();a.parentNode.replaceChild(d,a)}return this}}};a.appendShape=function(b,c){var d=null,e=c.x*a.scale.x,k=c.y*a.scale.y;"rect"===b?(d=document.createElementNS(a.svg.namespaceURI,"rect"),d.setAttribute("x",e),d.setAttribute("y",k),d.setAttribute("width",c.w*a.scale.x),d.setAttribute("height",c.h*a.scale.y)):"circle"===b&&(d=document.createElementNS(a.svg.namespaceURI,"ellipse"),d.setAttribute("cx",e),d.setAttribute("cy",
k),d.setAttribute("rx",c.r*a.scale.x),d.setAttribute("ry",c.r*a.scale.y));d.setAttribute("fill","transparent");d.setAttribute("stroke","transparent");d.setAttribute("stroke-width",a.lineWidth);d.setAttribute("transform","rotate("+a.rotate/(Math.PI/180)+") translate("+a.translate.x+","+a.translate.y+")");a.svg.appendChild(d);return a.eventObject(d)};f={rect:function(b,c,d,e){a.ctx.rect(b,c,d,e);return a.appendShape("rect",{x:b,y:c,w:d,h:e})},fillRect:function(b,c,d,e){a.ctx.fillRect(b,c,d,e);return a.appendShape("rect",
{x:b,y:c,w:d,h:e})},strokeRect:function(b,c,d,e){a.ctx.strokeRect(b,c,d,e);return a.appendShape("rect",{x:b,y:c,w:d,h:e})},clearRect:function(b,c,d,e){a.ctx.clearRect(b,c,d,e);return a.appendShape("rect",{x:b,y:c,w:d,h:e})},arc:function(b,c,d,e,k,f,h){a.ctx.arc(b,c,d,k,f,h);return a.appendShape("circle",{x:b,y:c,r:d})},createLinearGradient:function(b,c,d,e){return a.ctx.createLinearGradient(b,c,d,e)},createPattern:function(b,c){return a.ctx.createPattern(b,c)},createRadialGradient:function(b,c,d,
e,k,f){return a.ctx.createRadialGradient(b,c,d,e,k,f)},fill:function(){return a.ctx.fill()},stroke:function(){return a.ctx.stroke()},beginPath:function(){return a.ctx.beginPath()},moveTo:function(b,c){return a.ctx.moveTo(b,c)},closePath:function(){return a.ctx.closePath()},lineTo:function(b,c){return a.ctx.lineTo(b,c)},clip:function(){return a.ctx.clip()},quadraticCurveTo:function(b,c,d,e){return a.ctx.quadraticCurveTo(b,c,d,e)},bezierCurveTo:function(b,c,d,e,f,g){return a.ctx.bezierCurveTo(b,c,d,
e,f,g)},arcTo:function(b,c,d,e,f){return a.ctx.arcTo(b,c,d,e,f)},isPointInPath:function(b,c){return a.ctx.isPointInPath(b,c)},scale:function(b,c){a.scale.x=b;a.scale.y=c;return a.ctx.scale(b,c)},rotate:function(b){a.rotate=b;return a.ctx.rotate(b)},translate:function(b,c){a.translate.x=b;a.translate.y=c;return a.ctx.translate(b,c)},transform:function(b,c,d,e,f,g){return a.ctx.transform(b,c,d,e,f,g)},setTransform:function(b,c,d,e,f,g){return a.ctx.setTransform(b,c,d,e,f,g)},fillText:function(b,c,d,
e){a.ctx.fillText(b,c,d,e);e=parseInt(a.ctx.font,10);return a.appendShape("rect",{x:c,y:d-e,w:a.ctx.measureText(b).width,h:e})},strokeText:function(b,c,d,e){a.ctx.strokeText(b,c,d,e);e=parseInt(a.ctx.font,10);return a.appendShape("rect",{x:c,y:d-e,w:a.ctx.measureText(b).width,h:e})},measureText:function(b){return a.ctx.measureText(b)},drawImage:function(b,c,d,e,f,g,h,l,m){if(3===arguments.length)return a.ctx.drawImage(b,c,d),a.appendShape("rect",{x:c,y:d,w:b.width,h:b.height});if(5===arguments.length)return a.ctx.drawImage(b,
c,d,e,f),a.appendShape("rect",{x:c,y:d,w:e,h:f});if(9===arguments.length)return a.ctx.drawImage(b,c,d,e,f,g,h,l,m),a.appendShape("rect",{x:g,y:h,w:l,h:m});throw'Unkonwn function "drawImage" with '+arguments.length+" arguments";},createImageData:function(b,c){if(1===arguments.length)return a.ctx.createImageData(b);if(2===arguments.length)return a.ctx.createImageData(b,c);throw'Unkonwn function "createImageData" with '+arguments.length+" arguments";},getImageData:function(b,c,d,e){return a.ctx.getImageData(b,
c,d,e)},putImageData:function(b,c,d,e,f,g,h){if(3===arguments.length)return a.ctx.putImageData(b,c,d),a.appendShape("rect",{x:c,y:d,w:b.width,h:b.height});if(7===arguments.length)return a.ctx.putImageData(b,c,d,e,f,g,h),a.appendShape("rect",{x:c+e,y:d+f,w:g-e,h:h-f});throw'Unkonwn function "putImageData" with '+arguments.length+" arguments";},save:function(){return a.ctx.save()},restore:function(){return a.ctx.restore()},getContext:function(b,c){return a.ctx.getContext(b,c)},toDataURL:function(b,
c){if(0===arguments.length)return a.ctx.toDataURL();if(2===arguments.length)return a.ctx.toDataURL(b,c);throw'Unkonwn function "toDataURL" with '+arguments.length+" arguments";}};Object.defineProperty(f,"fillStyle",{get:function(){return a.ctx.fillStyle},set:function(b){a.ctx.fillStyle=b}});Object.defineProperty(f,"strokeStyle",{get:function(){return a.ctx.strokeStyle},set:function(b){a.ctx.strokeStyle=b}});Object.defineProperty(f,"shadowColor",{get:function(){return a.ctx.shadowColor},set:function(b){a.ctx.shadowColor=
b}});Object.defineProperty(f,"shadowBlur",{get:function(){return a.ctx.shadowBlur},set:function(b){a.ctx.shadowBlur=b}});Object.defineProperty(f,"shadowOffsetX",{get:function(){return a.ctx.shadowOffsetX},set:function(b){a.ctx.shadowOffsetX=b}});Object.defineProperty(f,"shadowOffsetY",{get:function(){return a.ctx.shadowOffsetY},set:function(b){a.ctx.shadowOffsetY=b}});Object.defineProperty(f,"lineCap",{get:function(){return a.ctx.lineCap},set:function(b){a.ctx.lineCap=b}});Object.defineProperty(f,
"lineJoin",{get:function(){return a.ctx.lineJoin},set:function(b){a.ctx.lineJoin=b}});Object.defineProperty(f,"lineWidth",{get:function(){return a.ctx.lineWidth},set:function(b){a.ctx.lineWidth=b;a.lineWidth=b}});Object.defineProperty(f,"miterLimit",{get:function(){return a.ctx.miterLimit},set:function(b){a.ctx.miterLimit=b}});Object.defineProperty(f,"font",{get:function(){return a.ctx.font},set:function(b){a.ctx.font=b}});Object.defineProperty(f,"textAlign",{get:function(){return a.ctx.textAlign},
set:function(b){a.ctx.textAlign=b}});Object.defineProperty(f,"textBaseline",{get:function(){return a.ctx.textBaseline},set:function(b){a.ctx.textBaseline=b}});Object.defineProperty(f,"globalAlpha",{get:function(){return a.ctx.globalAlpha},set:function(b){a.ctx.globalAlpha=b}});Object.defineProperty(f,"globalCompositeOperation",{get:function(){return a.ctx.globalCompositeOperation},set:function(b){a.ctx.globalCompositeOperation=b}});return f};
